<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barkas Elektronik</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --ink:#0f172a; --muted:#5b6475; --line:#e8eaf0;
      --brand:#2563eb; --success:#10b981; --chip:#eef2ff;
      --shadow:0 10px 30px rgba(15,23,42,.07); --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(1200px 500px at 50% -10%,#eaf2ff 0,transparent 60%),var(--bg);
      color:var(--ink); margin:0;
    }

    header{padding:28px 20px 8px;text-align:center;}
    .title{margin:8px 0 14px;font-size:clamp(28px,4.5vw,40px);letter-spacing:-.02em;font-weight:800;}

    .toolbar{
      margin:0 auto 18px; max-width:1200px; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; padding:0 20px;
    }
    #search{
      flex:1 1 520px; padding:12px 14px; border:1px solid var(--line); border-radius:12px; outline:none; background:#fff;
      font:500 14px Inter,sans-serif;
    }
    #search:focus{ box-shadow:0 0 0 3px rgba(37,99,235,.15); border-color:#cfd8ff }
    .select{ padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:#fff; font:500 14px Inter,sans-serif; cursor:pointer; }

    .wrap{ max-width:1200px; margin:0 auto; padding:0 20px 40px; }

    /* Cards */
    .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:18px; }
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
      overflow:hidden; transition:transform .18s ease, box-shadow .18s ease; cursor:pointer;
    }
    .card:hover{ transform:translateY(-4px); box-shadow:0 14px 40px rgba(15,23,42,.10); }

    .media{ position:relative; background:#0b1220; aspect-ratio:4/3; overflow:hidden; }
    .media img{ width:100%; height:100%; object-fit:contain; display:block; background:#0b1220; }
    .price-badge{
      position:absolute; left:12px; bottom:12px; background:#111827E6; color:#fff; font-weight:700; font-size:14px;
      padding:6px 10px; border-radius:10px; backdrop-filter:blur(6px);
    }

    .body{ padding:12px 14px 14px; }
    .name{ margin:2px 0 8px; font-weight:800; font-size:16px; letter-spacing:-.01em; }
    .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
    .chip{ font-size:12px; color:#1f2a44; background:var(--chip); padding:6px 8px; border-radius:999px; border:1px solid #e7e9ff; }
    .muted{ color:var(--muted); font-size:13px; line-height:1.5; }

    /* Modal */
    .modal{
      position:fixed; inset:0; background:rgba(13,19,34,.55);
      display:none; align-items:center; justify-content:center; z-index:9999; padding:24px;
    }
    .modal.open{ display:flex; }

    .dialog{
      position:relative;
      background:#fff; width:min(1120px,96vw); height:clamp(560px,92vh,900px);
      border-radius:18px; overflow:hidden; box-shadow:0 20px 70px rgba(15,23,42,.25);
      display:grid; grid-template-columns:minmax(0,1.25fr) minmax(0,1fr);
    }
    @media (max-width:900px){ .dialog{ grid-template-columns:1fr; } }

    /* Left column (image + thumbs) */
    .left{
      background:#000; display:grid; grid-template-rows:minmax(0,1fr) auto; min-height:0;
    }
    .imagebox{
      position:relative; display:flex; align-items:center; justify-content:center;
      min-height:0; height:100%; overflow:hidden;
    }
    .mainimg{
      width:100% !important; height:100% !important;
      max-width:100% !important; max-height:100% !important;
      object-fit:contain !important; object-position:center center !important;
      background:#000; display:block;
    }
    .nav{
      position:absolute; top:50%; transform:translateY(-50%);
      background:#ffffffdd; border:none; width:36px; height:36px; border-radius:10px; cursor:pointer; font-size:18px;
    }
    .nav.prev{ left:10px } .nav.next{ right:10px }

    .thumbs{ display:flex; gap:10px; padding:12px; overflow:auto; background:rgba(0,0,0,.25); }
    .thumb{ width:86px; height:64px; object-fit:cover; border:2px solid transparent; border-radius:10px; cursor:pointer; background:#111; opacity:.9; }
    .thumb.active{ border-color:var(--brand); opacity:1; }

    /* Right column (modern spec sheet) */
    .right{ padding:18px 22px 16px; overflow:auto; min-width:0; }
    .close{
      position:absolute; top:12px; right:14px; background:#fff; border:none; width:38px; height:38px; border-radius:12px;
      box-shadow:var(--shadow); cursor:pointer; font-weight:700;
    }
    .ttl{ margin:0 0 2px; font-size:22px; letter-spacing:-.01em; }
    .price-box{
      display:inline-block;
      background:linear-gradient(90deg,#10b981,#059669);
      color:#fff;
      padding:10px 18px;
      border-radius:14px;
      font-weight:800;
      font-size:20px;
      letter-spacing:-.02em;
      box-shadow:0 4px 12px rgba(16,185,129,.25);
      margin:4px 0 18px;
    }
    .price-label{
      font-size:13px;
      font-weight:600;
      color:#64748b;
      margin-bottom:4px;
      text-transform:uppercase;
      letter-spacing:.06em;
    }
    @media(max-width:600px){
      .price-box{ font-size:18px; padding:8px 14px; }
    }
    .spec{ margin:0 0 14px; color:var(--muted); }

    /* Sections */
    .sections{ display:flex; flex-direction:column; gap:16px; }
    .section{
      border:1px solid var(--line); border-radius:12px; padding:12px; background:#fff;
    }
    .sec-title{
      margin:0 0 10px; font-size:13px; font-weight:700; letter-spacing:.08em; text-transform:uppercase; color:#25324a;
    }

    /* Key–Value grid */
    .kv{ display:grid; grid-template-columns:140px 1fr; gap:8px 12px; padding:10px 0; align-items:start; }
    .kv + .kv{ border-top:1px dashed #e8ecf6; }
    .k{ font-size:12px; color:#5f6a82; letter-spacing:.02em; text-transform:uppercase; }
    .v{ font-size:14px; color:#0f172a; font-weight:600; word-break:break-word; }

    /* Chips for multi-values */
    .mini-chips{ display:flex; flex-wrap:wrap; gap:6px; }
    .mini-chip{
      display:inline-flex; align-items:center; padding:6px 8px; font-size:12px; border-radius:999px;
      background:#f4f6ff; border:1px solid #e3e7ff; color:#26345c;
    }

    /* Note card */
    .note{
      margin-top:8px; padding:10px 12px; background:#f8fafc; border:1px dashed #e2e8f0; border-radius:10px; color:#334155; font-size:13px;
    }

    .sr{ position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; padding:0; margin:-1px; }
  </style>
</head>
<body>
  <header><h1 class="title">Barkas Elektronik</h1></header>

  <div class="toolbar">
    <input id="search" type="search" placeholder="Cari laptop…">
    <select id="sort" class="select" aria-label="Urutkan">
      <option value="default">Urutkan: Default</option>
      <option value="price-desc">Harga tertinggi</option>
      <option value="price-asc">Harga terendah</option>
      <option value="name-asc">Nama A–Z</option>
    </select>
  </div>

  <div class="wrap"><div id="cards" class="grid"></div></div>

  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="dialog">
      <button class="close" aria-label="Tutup">✕</button>

      <div class="left">
        <div class="imagebox">
          <img id="mainImg" class="mainimg" src="" alt="Foto laptop" referrerpolicy="no-referrer">
          <button class="nav prev" aria-label="Sebelumnya">‹</button>
          <button class="nav next" aria-label="Berikutnya">›</button>
        </div>
        <div id="thumbs" class="thumbs"></div>
      </div>

      <div class="right">
      <h2 id="mTitle" class="ttl"></h2>

      <div class="price-wrapper">
        <div class="price-label">Harga</div>
        <div id="mPrice" class="price-box"></div>
      </div>

      <p id="mSpecs" class="spec"></p>


        <!-- Modern sections container -->
        <div id="mDetails" class="sections"></div>
      </div>
    </div>
  </div>

  <span class="sr" id="sr-live" aria-live="polite"></span>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    // ===== CONFIG =====
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkTcSTn8vWCmXO1Lh_AJLwdmCZBQX8TUpj0cvdeRGifFy4ggOMphy6vvZ1c9MLcQPFW3GBL9IvsS9y/pub?gid=1632018587&single=true&output=csv";

    // ===== DOM =====
    const cardsDiv = document.getElementById('cards');
    const searchInput = document.getElementById('search');
    const sortSel = document.getElementById('sort');
    const modal = document.getElementById('modal');
    const mainImg = document.getElementById('mainImg');
    const thumbs = document.getElementById('thumbs');
    const mTitle = document.getElementById('mTitle');
    const mPrice = document.getElementById('mPrice');
    const mSpecs = document.getElementById('mSpecs');
    const mDetails = document.getElementById('mDetails');
    const btnPrev = document.querySelector('.nav.prev');
    const btnNext = document.querySelector('.nav.next');
    const btnClose = document.querySelector('.close');

    let DATA = [];
    let currentGallery = [];
    let currentIndex = 0;

    // ===== Helpers =====
    const norm = s => String(s || "").replace(/\s+/g, " ").trim();
    function get(row, aliases) {
      if (!row.__norm) { row.__norm = {}; for (const k of Object.keys(row)) row.__norm[norm(k)] = row[k]; }
      for (const a of aliases) { const v = row.__norm[norm(a)]; if (v !== undefined && v !== "") return v; }
      return "";
    }
    const money = raw => {
      if (!raw) return "";
      const n = Number(String(raw).replace(/[^\d]/g,""));
      if (!n) return raw;
      return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);
    };

    const A = {
      title:["Title","Merk / Tipe Laptop"],
      brand:["Brand","Merk","Merk / Tipe Laptop"],
      cpu:["CPU","Prosesor (Brand & Seri)"],
      ram:["RAM","RAM (Kapasitas & Jenis)"],
      storageType:["Storage","Storage (HDD / SSD / eMMC)"],
      storageCap:["Kapasitas Storage (GB / TB)"],
      gpu:["GPU","GPU / VGA"],
      display:["Display","Ukuran Layar (Inch)"],
      os:["OS","Sistem Operasi (OS)"],
      condition:["Condition","Kondisi Barang"],
      price:["Estimasi Nilai Pasar (Rp)","Price","Estimasi Nilai Pasar (Rp)  "],
      branch:["Cabang Toko"],
      image1:["Image","Upload Foto Tampak Depan","Foto Depan"],
      image2:["Upload Foto Tampak Belakang","Foto Belakang"],
      image3:["Upload Foto Samping Kiri / Kanan","Foto Kiri/Kanan"],
      image4:["Upload Foto Keyboard & Layar (Nyala)","Foto Keyboard/Layar"],
      ports:["Port yang Tersedia"],
      body:["Kondisi Fisik Body"],
      keyboard:["Kondisi Keyboard"],
      lcd:["Kondisi LCD / Layar"],
      battery:["Kondisi Baterai"],
      charger:["Kondisi Charger"],
      optical:["Optical Drive (CD Room)"],
      extras:["Kelengkapan Tambahan"],
      notes:["Catatan Kondisi Tambahan"]
    };

    // Convert various Drive URL formats to "uc?export=view"
    function toDirectDrive(url){
      if(!url) return "";
      const m = String(url).trim().match(/(?:open\?id=|\/d\/|id=)([A-Za-z0-9_-]{10,})/);
      return m ? `https://drive.google.com/uc?export=view&id=${m[1]}` : url;
    }
    // Convert to fast, reliable lh3 host (with size)
    function toLh3(u, size=600){
      if(!u) return "";
      const m = String(u).match(/id=([A-Za-z0-9_-]{10,})/);
      return m ? `https://lh3.googleusercontent.com/d/${m[1]}=w${size}` : u;
    }

    function collectImages(r){
      const arr = [A.image1,A.image2,A.image3,A.image4]
        .map(al=>toDirectDrive(get(r,al))).filter(Boolean);
      return arr.length ? arr : ["https://via.placeholder.com/1200x800?text=No+Image"];
    }

    function specLine(r){
      const cpu=get(r,A.cpu), ram=get(r,A.ram), st=get(r,A.storageType), sc=get(r,A.storageCap),
            storage=[st,sc].filter(Boolean).join(" "), gpu=get(r,A.gpu), disp=get(r,A.display),
            os=get(r,A.os), cond=get(r,A.condition), branch=get(r,A.branch);
      return [cpu,ram,storage,gpu,disp,os,cond,branch].filter(Boolean).join(" • ");
    }

    // Chips builder for multi-value strings
    function chipsHTML(str){
      const parts = String(str||"").split(/[;,•]/).map(s=>s.trim()).filter(Boolean);
      if(!parts.length) return "";
      return `<div class="mini-chips">${parts.map(t=>`<span class="mini-chip">${t}</span>`).join("")}</div>`;
    }

    // Section renderer (clean, grouped layout)
    function detailsHTML(r){
      const sec = (title, rows) => {
        const items = rows
          .map(([label, value, mode]) => {
            if(!value) return "";
            if(mode === "chips") {
              return `<div class="kv"><div class="k">${label}</div><div class="v">${chipsHTML(value)}</div></div>`;
            }
            if(mode === "note") {
              return `<div class="kv"><div class="k">${label}</div><div class="v"><div class="note">${value}</div></div></div>`;
            }
            return `<div class="kv"><div class="k">${label}</div><div class="v">${value}</div></div>`;
          })
          .filter(Boolean)
          .join("");
        return items ? `<section class="section"><h3 class="sec-title">${title}</h3>${items}</section>` : "";
      };

      const spesifikasi = [
        ["Cabang", get(r,A.branch)],
        ["Prosesor", get(r,A.cpu)],
        ["RAM", get(r,A.ram)],
        ["Storage", [get(r,A.storageType),get(r,A.storageCap)].filter(Boolean).join(" ")],
        ["GPU", get(r,A.gpu)],
        ["Ukuran Layar", get(r,A.display)],
        ["Sistem Operasi", get(r,A.os)]
      ];

      const kondisi = [
        ["Kondisi", get(r,A.condition)],
        ["Kondisi Body", get(r,A.body)],
        ["Kondisi Keyboard", get(r,A.keyboard)],
        ["Kondisi Layar", get(r,A.lcd)],
        ["Baterai", get(r,A.battery)],
        ["Charger", get(r,A.charger)],
        ["Optical Drive", get(r,A.optical)]
      ];

      const kelengkapan = [
        ["Port", get(r,A.ports), "chips"],
        ["Kelengkapan", get(r,A.extras), "chips"],
        ["Catatan", get(r,A.notes), "note"]
      ];

      return sec("Spesifikasi", spesifikasi) +
             sec("Kondisi", kondisi) +
             sec("Kelengkapan", kelengkapan);
    }

    // ===== Render cards =====
    function render(list){
      cardsDiv.innerHTML = "";
      list.forEach(r=>{
        const title = get(r,A.title) || get(r,A.brand) || "Tanpa Judul";
        const imgs = collectImages(r);
        const price = money(get(r,A.price));
        const line = specLine(r);

        const card = document.createElement('div'); card.className='card';
        card.innerHTML = `
          <div class="media">
            <img src="${imgs[0]}" alt="Foto ${title}" referrerpolicy="no-referrer"
              onerror="this.onerror=null; const m=this.src.match(/id=([A-Za-z0-9_-]{10,})/); this.src=m ? 'https://lh3.googleusercontent.com/d/'+m[1]+'=w1280' : 'https://via.placeholder.com/600x375?text=No+Image';">
            ${price ? `<div class="price-badge">${price}</div>` : ""}
          </div>
          <div class="body">
            <div class="name">${title}</div>
            <div class="chips">
              ${[get(r,A.cpu),get(r,A.ram),get(r,A.storageType),get(r,A.storageCap)]
                .filter(Boolean).slice(0,3).map(t=>`<span class="chip">${t}</span>`).join('')}
            </div>
            <p class="muted">${line}</p>
          </div>`;
        card.addEventListener('click', ()=> openModal(r));
        cardsDiv.appendChild(card);
      });
      document.getElementById('sr-live').textContent = `${list.length} item ditampilkan`;
    }

    // ===== Modal =====
    function openModal(r){
      mTitle.textContent = get(r,A.title) || get(r,A.brand) || "Tanpa Judul";
      mPrice.textContent = money(get(r,A.price)) || "";
      mSpecs.textContent = specLine(r);
      mDetails.innerHTML = detailsHTML(r);

      currentGallery = collectImages(r);
      currentIndex = 0;
      paintThumbs();
      showImage(0);

      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }

    function showImage(i){
      currentIndex = (i + currentGallery.length) % currentGallery.length;
      const src = currentGallery[currentIndex];

      // Try original first; if Drive blocks, swap to lh3
      mainImg.src = src;
      mainImg.referrerPolicy = "no-referrer";
      mainImg.onerror = ()=>{
        mainImg.onerror = null;
        const m = src.match(/id=([A-Za-z0-9_-]{10,})/);
        if (m) {
          mainImg.src = `https://lh3.googleusercontent.com/d/${m[1]}=w1600`;
        } else {
          mainImg.src = "https://via.placeholder.com/1200x800?text=No+Image";
        }
      };

      // update active state
      [...thumbs.children].forEach((el,idx)=> el.classList.toggle('active', idx===currentIndex));
    }

    function paintThumbs(){
      thumbs.innerHTML = "";
      currentGallery.forEach((u,i)=>{
        const t = document.createElement('img');
        t.className = 'thumb';
        t.referrerPolicy = 'no-referrer';
        t.loading = 'lazy';

        // Prefer lh3 (faster and less likely to be blocked)
        t.src = toLh3(u, 320);
        t.onerror = () => {
          t.onerror = null;
          // Try original (uc?export=view); if still fails, placeholder
          t.src = u;
          t.onerror = () => { t.src = 'https://via.placeholder.com/160x120?text=No+Image'; };
        };

        t.addEventListener('click', e=>{ e.stopPropagation(); showImage(i); });
        thumbs.appendChild(t);
      });
      if (thumbs.firstChild) thumbs.firstChild.classList.add('active');
    }

    btnClose.addEventListener('click', closeModal);
    modal.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });
    btnPrev.addEventListener('click', e=>{ e.stopPropagation(); showImage(currentIndex-1); });
    btnNext.addEventListener('click', e=>{ e.stopPropagation(); showImage(currentIndex+1); });
    window.addEventListener('keydown', e=>{
      if(!modal.classList.contains('open')) return;
      if(e.key==='Escape') closeModal();
      if(e.key==='ArrowLeft') showImage(currentIndex-1);
      if(e.key==='ArrowRight') showImage(currentIndex+1);
    });

    // ===== Search + Sort =====
    function applyFilters(){
      const term = (searchInput.value || "").toLowerCase();
      let list = DATA.filter(r =>
        (get(r,A.title)||get(r,A.brand)||"").toLowerCase().includes(term) ||
        Object.values(r).join(" ").toLowerCase().includes(term)
      );

      const mode = sortSel.value;
      if(mode==='price-desc' || mode==='price-asc'){
        const dir = mode==='price-desc' ? -1 : 1;
        list = [...list].sort((a,b)=>{
          const na = Number(String(get(a,A.price)).replace(/[^\d]/g,"")) || 0;
          const nb = Number(String(get(b,A.price)).replace(/[^\d]/g,"")) || 0;
          return (na-nb)*dir;
        });
      }
      if(mode==='name-asc'){
        list = [...list].sort((a,b)=> (get(a,A.title)||"").localeCompare(get(b,A.title)||""));
      }
      render(list);
    }

    // ===== Load data =====
    function loadData(){
      Papa.parse(SHEET_CSV_URL, {
        download:true, header:true,
        complete: res => {
          DATA = res.data.filter(r => get(r,A.title) || get(r,A.brand));
          applyFilters();
          searchInput.addEventListener('input', applyFilters);
          sortSel.addEventListener('change', applyFilters);
        },
        error: err => { cardsDiv.textContent = "Gagal memuat data"; console.error(err); }
      });
    }
    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>

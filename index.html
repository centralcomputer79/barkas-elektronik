<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Barkas Elektronik</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#f6f7fb;
    --panel:#ffffff;
    --ink:#0f172a;
    --muted:#6b7280;
    --line:#e9ecf2;
    --line-soft:#f1f3f7;
    --brand:#2563eb;
    --success:#0ea5e9;
    --shadow:0 12px 30px rgba(15,23,42,.08);
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1100px 460px at 50% -10%, #eaf2ff 0%, transparent 60%),
      var(--bg);
    color:var(--ink); margin:0; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  header{padding:28px 20px 8px;text-align:center;}
  .title{margin:8px 0 14px;font-size:clamp(28px,4.5vw,40px);letter-spacing:-.02em;font-weight:800;color:#0b1220;}

  .toolbar{
    margin:0 auto 18px; max-width:1200px; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; padding:0 20px;
  }
  #search{
    flex:1 1 520px; padding:12px 14px; border:1px solid var(--line); border-radius:12px; outline:none; background:#fff;
    font:500 14px Inter,sans-serif;
  }
  #search::placeholder{color:#97a1b3}
  #search:focus{ box-shadow:0 0 0 3px rgba(37,99,235,.15); border-color:#cfd8ff }
  .select{ padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:#fff; font:500 14px Inter,sans-serif; cursor:pointer; }

  .wrap{ max-width:1200px; margin:0 auto; padding:0 20px 40px; }

  /* Cards */
  .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:18px; }
  .card{
    background:#fff; border:1px solid var(--line); border-radius:14px; box-shadow:var(--shadow);
    overflow:hidden; transition:transform .18s ease, box-shadow .18s ease; cursor:pointer;
  }
  .card:hover{ transform:translateY(-3px); box-shadow:0 16px 40px rgba(15,23,42,.12); }
  .media{ position:relative; background:#0b1220; aspect-ratio:4/3; overflow:hidden; }
  .media img{ width:100%; height:100%; object-fit:contain; display:block; background:#0b1220; }
  .price-badge{
    position:absolute; left:12px; bottom:12px; background:#111827E6; color:#fff; font-weight:700; font-size:13px;
    padding:6px 10px; border-radius:10px; backdrop-filter:blur(6px);
  }
  .body{ padding:12px 14px 14px; }
  .name{ margin:2px 0 8px; font-weight:800; font-size:16px; letter-spacing:-.01em; }
  .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
  .chip{ font-size:12px; color:#1f2a44; background:#f4f6fc; padding:6px 8px; border-radius:999px; border:1px solid #e7e9f6; }
  .muted{ color:var(--muted); font-size:13px; line-height:1.5; }

  /* Modal */
  .modal{
    position:fixed; inset:0; background:rgba(13,19,34,.55);
    display:none; align-items:center; justify-content:center; z-index:9999; padding:24px;
  }
  .modal.open{ display:flex; }
  .dialog{
    position:relative;
    width:min(1120px,96vw); height:clamp(560px,92vh,900px);
    border-radius:18px; overflow:hidden; box-shadow:0 24px 70px rgba(15,23,42,.28);
    display:grid; grid-template-columns:minmax(0,1.25fr) minmax(0,1fr);
    background:#000;   /* base black so no white peeks around image */
    border:none;
  }

  @media (max-width:900px){ .dialog{ grid-template-columns:1fr; } }

  /* Left */
  .left{ background:#000; display:grid; grid-template-rows:minmax(0,1fr) auto; min-height:0; }
  .imagebox{ position:relative; display:flex; align-items:center; justify-content:center; min-height:0; height:100%; overflow:hidden; }
  .mainimg{
    width:100% !important; height:100% !important; max-width:100% !important; max-height:100% !important;
    object-fit:contain !important; object-position:center center !important; background:#000; display:block;
  }
  .nav{
    position:absolute; top:50%; transform:translateY(-50%); background:#ffffff; border:1px solid var(--line);
    width:36px; height:36px; border-radius:10px; cursor:pointer; font-size:18px;
    box-shadow:0 6px 18px rgba(15,23,42,.15);
  }
  .nav.prev{ left:10px } .nav.next{ right:10px }
  .thumbs{ display:flex; gap:10px; padding:12px; overflow:auto; background:#0b0b0b; }
  .thumb{ width:86px; height:64px; object-fit:cover; border:2px solid transparent; border-radius:10px; cursor:pointer; background:#111; opacity:.95; }
  .thumb.active{ border-color:var(--brand); opacity:1; }

  /* Right – minimal, sleek */
  .right{ padding:12px 22px 18px; overflow:auto; min-width:0; }
  .close{
    position:absolute; top:12px; right:14px; background:#fff; border:1px solid var(--line); width:38px; height:38px; border-radius:12px;
    box-shadow:var(--shadow); cursor:pointer; font-weight:700;
  }

  /* Header block */
  .hero{ position:sticky; top:0; background:#fff; padding:12px 0 14px; border-bottom:1px solid var(--line-soft); z-index:2; }
  .ttl{ margin:0; font-size:22px; letter-spacing:-.01em; font-weight:800; color:#0b1220; }
  .price-line{ display:flex; align-items:baseline; gap:10px; margin:6px 0 10px; }
  .price-label{ font-size:12px; font-weight:600; color:#8a93a6; letter-spacing:.08em; text-transform:uppercase; }
  .price-val{
    font-weight:800; letter-spacing:-.02em; color:#0b1220;
    font-size:28px; line-height:1; font-variant-numeric:tabular-nums;
  }
  @media (max-width:600px){ .price-val{ font-size:24px } }

  .meta{ display:flex; flex-wrap:wrap; gap:6px; }
  .meta-chip{
    font-size:12px; color:#3b4255; background:#f6f7fb;
    border:1px solid var(--line); padding:6px 8px; border-radius:999px;
  }

  /* Sections */
  .sections{ display:flex; flex-direction:column; gap:14px; padding-top:14px; }
  .section{
    background:#fff; border:1px solid var(--line); border-radius:12px; padding:12px;
  }
  .sec-title{
    margin:0 0 8px; font-size:12px; font-weight:800; letter-spacing:.14em; text-transform:uppercase; color:#5b6475;
  }

  .kv{ display:grid; grid-template-columns:150px 1fr; gap:8px 12px; padding:10px 0; align-items:start; }
  .kv + .kv{ border-top:1px solid var(--line-soft); }
  .k{ font-size:12px; color:#7a8397; letter-spacing:.04em; text-transform:uppercase; }
  .v{ font-size:14px; color:#0f172a; font-weight:600; word-break:break-word; }

  .mini-chips{ display:flex; flex-wrap:wrap; gap:6px; }
  .mini-chip{ display:inline-flex; align-items:center; padding:6px 8px; font-size:12px; border-radius:999px; background:#f6f7fb; border:1px solid var(--line); color:#23304e; }

  .note{ margin-top:8px; padding:10px 12px; background:#f8fafc; border:1px dashed #e2e8f0; border-radius:10px; color:#334155; font-size:13px; }

  .sr{ position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; padding:0; margin:-1px; }
</style>
</head>
<body>
  <header><h1 class="title">Barkas Elektronik</h1></header>

  <div class="toolbar">
    <input id="search" type="search" placeholder="Cari laptop…">
    <select id="sort" class="select" aria-label="Urutkan">
      <option value="default">Urutkan: Default</option>
      <option value="price-desc">Harga tertinggi</option>
      <option value="price-asc">Harga terendah</option>
      <option value="name-asc">Nama A–Z</option>
    </select>
  </div>

  <div class="wrap"><div id="cards" class="grid"></div></div>

  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="dialog">
      <button class="close" aria-label="Tutup">✕</button>

      <div class="left">
        <div class="imagebox">
          <img id="mainImg" class="mainimg" src="" alt="Foto laptop" referrerpolicy="no-referrer">
          <button class="nav prev" aria-label="Sebelumnya">‹</button>
          <button class="nav next" aria-label="Berikutnya">›</button>
        </div>
        <div id="thumbs" class="thumbs"></div>
      </div>

      <div class="right">
        <!-- Minimal header -->
        <div class="hero">
          <h2 id="mTitle" class="ttl"></h2>
          <div class="price-wrapper">
            <div class="price-label">Harga</div>
            <div id="mPrice" class="price-box"></div>
          </div>
          <div id="mMeta" class="meta"></div>
        </div>

        <!-- Sections -->
        <div id="mDetails" class="sections"></div>
      </div>
    </div>
  </div>

  <span class="sr" id="sr-live" aria-live="polite"></span>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
  // ===== CONFIG =====
  const SHEET_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkTcSTn8vWCmXO1Lh_AJLwdmCZBQX8TUpj0cvdeRGifFy4ggOMphy6vvZ1c9MLcQPFW3GBL9IvsS9y/pub?gid=1632018587&single=true&output=csv";

  // ===== DOM =====
  const cardsDiv = document.getElementById('cards');
  const searchInput = document.getElementById('search');
  const sortSel = document.getElementById('sort');
  const modal = document.getElementById('modal');
  const mainImg = document.getElementById('mainImg');
  const thumbs = document.getElementById('thumbs');
  const mTitle = document.getElementById('mTitle');
  const mPrice = document.getElementById('mPrice');
  const mMeta = document.getElementById('mMeta');
  const mDetails = document.getElementById('mDetails');

  let DATA = [], currentGallery = [], currentIndex = 0;

  // ===== Helpers =====
  const norm = s => String(s || "").replace(/\s+/g, " ").trim();
  function get(row, aliases) {
    if (!row.__norm) { row.__norm = {}; for (const k of Object.keys(row)) row.__norm[norm(k)] = row[k]; }
    for (const a of aliases) { const v = row.__norm[norm(a)]; if (v !== undefined && v !== "") return v; }
    return "";
  }
  const money = raw => {
    if (!raw) return "";
    const n = Number(String(raw).replace(/[^\d]/g,""));
    if (!n) return String(raw).replace(/^Rp/i,'').trim();
    return "Rp " + new Intl.NumberFormat('id-ID',{maximumFractionDigits:0}).format(n);
  };

  const A = {
    title:["Title","Merk / Tipe Laptop"],
    brand:["Brand","Merk","Merk / Tipe Laptop"],
    cpu:["CPU","Prosesor (Brand & Seri)"],
    ram:["RAM","RAM (Kapasitas & Jenis)"],
    storageType:["Storage","Storage (HDD / SSD / eMMC)"],
    storageCap:["Kapasitas Storage (GB / TB)"],
    gpu:["GPU","GPU / VGA"],
    display:["Display","Ukuran Layar (Inch)"],
    os:["OS","Sistem Operasi (OS)"],
    condition:["Condition","Kondisi Barang"],
    price:["Estimasi Nilai Pasar (Rp)","Price","Estimasi Nilai Pasar (Rp)  "],
    branch:["Cabang Toko"],
    image1:["Image","Upload Foto Tampak Depan","Foto Depan"],
    image2:["Upload Foto Tampak Belakang","Foto Belakang"],
    image3:["Upload Foto Samping Kiri / Kanan","Foto Kiri/Kanan"],
    image4:["Upload Foto Keyboard & Layar (Nyala)","Foto Keyboard/Layar"],
    ports:["Port yang Tersedia"],
    body:["Kondisi Fisik Body"],
    keyboard:["Kondisi Keyboard"],
    lcd:["Kondisi LCD / Layar"],
    battery:["Kondisi Baterai"],
    charger:["Kondisi Charger"],
    optical:["Optical Drive (CD Room)"],
    extras:["Kelengkapan Tambahan"],
    notes:["Catatan Kondisi Tambahan"]
  };

  function toDirectDrive(url){
    if(!url) return "";
    const m = String(url).trim().match(/(?:open\?id=|\/d\/|id=)([A-Za-z0-9_-]{10,})/);
    return m ? `https://drive.google.com/uc?export=view&id=${m[1]}` : url;
  }
  function toLh3(u,size=600){
    if(!u) return "";
    const m = String(u).match(/id=([A-Za-z0-9_-]{10,})/);
    return m ? `https://lh3.googleusercontent.com/d/${m[1]}=w${size}` : u;
  }
  function collectImages(r){
    const arr = [A.image1,A.image2,A.image3,A.image4].map(al=>toDirectDrive(get(r,al))).filter(Boolean);
    return arr.length ? arr : ["https://via.placeholder.com/1200x800?text=No+Image"];
  }

  function specLineParts(r){
    const cpu=get(r,A.cpu), ram=get(r,A.ram), st=get(r,A.storageType), sc=get(r,A.storageCap),
          storage=[st,sc].filter(Boolean).join(" "), gpu=get(r,A.gpu), disp=get(r,A.display),
          os=get(r,A.os), cond=get(r,A.condition), branch=get(r,A.branch);
    return [cpu,ram,storage,gpu,disp,os,cond,branch].filter(Boolean);
  }

  function chipsHTML(parts){
    return parts.map(t=>`<span class="meta-chip">${t}</span>`).join("");
  }

  // Section renderer (clean, grouped)
  function detailsHTML(r){
    const sec = (title, rows) => {
      const items = rows.map(([label,value,mode])=>{
        if(!value) return "";
        if(mode==="chips") return `<div class="kv"><div class="k">${label}</div><div class="v"><div class="mini-chips">${String(value).split(/[•,;]+/).map(x=>`<span class="mini-chip">${x.trim()}</span>`).join("")}</div></div></div>`;
        if(mode==="note")  return `<div class="kv"><div class="k">${label}</div><div class="v"><div class="note">${value}</div></div></div>`;
        return `<div class="kv"><div class="k">${label}</div><div class="v">${value}</div></div>`;
      }).join("");
      return items ? `<section class="section"><h3 class="sec-title">${title}</h3>${items}</section>` : "";
    };
    const spesifikasi = [
      ["Cabang", get(r,A.branch)],
      ["Prosesor", get(r,A.cpu)],
      ["RAM", get(r,A.ram)],
      ["Storage", [get(r,A.storageType),get(r,A.storageCap)].filter(Boolean).join(" ")],
      ["GPU", get(r,A.gpu)],
      ["Ukuran Layar", get(r,A.display)],
      ["Sistem Operasi", get(r,A.os)]
    ];
    const kondisi = [
      ["Kondisi", get(r,A.condition)],
      ["Kondisi Body", get(r,A.body)],
      ["Kondisi Keyboard", get(r,A.keyboard)],
      ["Kondisi Layar", get(r,A.lcd)],
      ["Baterai", get(r,A.battery)],
      ["Charger", get(r,A.charger)],
      ["Optical Drive", get(r,A.optical)]
    ];
    const kelengkapan = [
      ["Port", get(r,A.ports), "chips"],
      ["Kelengkapan", get(r,A.extras), "chips"],
      ["Catatan", get(r,A.notes), "note"]
    ];
    return sec("Spesifikasi", spesifikasi) + sec("Kondisi", kondisi) + sec("Kelengkapan", kelengkapan);
  }

  // ===== Render cards =====
  function render(list){
    cardsDiv.innerHTML = "";
    list.forEach(r=>{
      const title = get(r,A.title) || get(r,A.brand) || "Tanpa Judul";
      const imgs = collectImages(r);
      const price = money(get(r,A.price));
      const lineParts = specLineParts(r);

      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `
        <div class="media">
          <img src="${imgs[0]}" alt="Foto ${title}" referrerpolicy="no-referrer"
            onerror="this.onerror=null; const m=this.src.match(/id=([A-Za-z0-9_-]{10,})/); this.src=m ? 'https://lh3.googleusercontent.com/d/'+m[1]+'=w1280' : 'https://via.placeholder.com/600x375?text=No+Image';">
          ${price ? `<div class="price-badge">${price}</div>` : ""}
        </div>
        <div class="body">
          <div class="name">${title}</div>
          <div class="chips">
            ${lineParts.slice(0,3).map(t=>`<span class="chip">${t}</span>`).join('')}
          </div>
          <p class="muted">${lineParts.join(" • ")}</p>
        </div>`;
      card.addEventListener('click', ()=> openModal(r));
      cardsDiv.appendChild(card);
    });
    document.getElementById('sr-live').textContent = `${list.length} item ditampilkan`;
  }

  // ===== Modal =====
  function openModal(r){
    mTitle.textContent = get(r,A.title) || get(r,A.brand) || "Tanpa Judul";
    mPrice.textContent = money(get(r,A.price)) || "";
    mMeta.innerHTML = chipsHTML(specLineParts(r));
    mDetails.innerHTML = detailsHTML(r);

    currentGallery = collectImages(r);
    currentIndex = 0;
    paintThumbs();
    showImage(0);

    modal.classList.add('open');
    modal.setAttribute('aria-hidden','false');
    document.body.style.overflow='hidden';
  }
  function closeModal(){
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
  }

  function showImage(i){
    currentIndex = (i + currentGallery.length) % currentGallery.length;
    const src = currentGallery[currentIndex];
    mainImg.src = src;
    mainImg.referrerPolicy = "no-referrer";
    mainImg.onerror = ()=>{
      mainImg.onerror = null;
      const m = src.match(/id=([A-Za-z0-9_-]{10,})/);
      mainImg.src = m ? `https://lh3.googleusercontent.com/d/${m[1]}=w1600` : "https://via.placeholder.com/1200x800?text=No+Image";
    };
    [...thumbs.children].forEach((el,idx)=> el.classList.toggle('active', idx===currentIndex));
  }

  function paintThumbs(){
    thumbs.innerHTML = "";
    currentGallery.forEach((u,i)=>{
      const t = document.createElement('img');
      t.className = 'thumb';
      t.referrerPolicy = 'no-referrer';
      t.loading = 'lazy';
      t.src = toLh3(u, 320);
      t.onerror = () => { t.onerror=null; t.src=u; t.onerror=()=>{ t.src='https://via.placeholder.com/160x120?text=No+Image'; }; };
      t.addEventListener('click', e=>{ e.stopPropagation(); showImage(i); });
      thumbs.appendChild(t);
    });
    if (thumbs.firstChild) thumbs.firstChild.classList.add('active');
  }

  document.querySelector('.close').addEventListener('click', closeModal);
  document.getElementById('modal').addEventListener('click', e=>{ if(e.target===modal) closeModal(); });
  document.querySelector('.nav.prev').addEventListener('click', e=>{ e.stopPropagation(); showImage(currentIndex-1); });
  document.querySelector('.nav.next').addEventListener('click', e=>{ e.stopPropagation(); showImage(currentIndex+1); });
  window.addEventListener('keydown', e=>{
    if(!modal.classList.contains('open')) return;
    if(e.key==='Escape') closeModal();
    if(e.key==='ArrowLeft') showImage(currentIndex-1);
    if(e.key==='ArrowRight') showImage(currentIndex+1);
  });

  // ===== Search + Sort =====
  function applyFilters(){
    const term = (searchInput.value || "").toLowerCase();
    let list = DATA.filter(r =>
      (get(r,A.title)||get(r,A.brand)||"").toLowerCase().includes(term) ||
      Object.values(r).join(" ").toLowerCase().includes(term)
    );

    const mode = sortSel.value;
    if(mode==='price-desc' || mode==='price-asc'){
      const dir = mode==='price-desc' ? -1 : 1;
      list = [...list].sort((a,b)=>{
        const na = Number(String(get(a,A.price)).replace(/[^\d]/g,"")) || 0;
        const nb = Number(String(get(b,A.price)).replace(/[^\d]/g,"")) || 0;
        return (na-nb)*dir;
      });
    }
    if(mode==='name-asc'){
      list = [...list].sort((a,b)=> (get(a,A.title)||"").localeCompare(get(b,A.title)||""));
    }
    render(list);
  }

  // ===== Load data =====
  function loadData(){
    Papa.parse(SHEET_CSV_URL, {
      download:true, header:true,
      complete: res => {
        DATA = res.data.filter(r => get(r,A.title) || get(r,A.brand));
        applyFilters();
        searchInput.addEventListener('input', applyFilters);
        sortSel.addEventListener('change', applyFilters);
      },
      error: err => { cardsDiv.textContent = "Gagal memuat data"; console.error(err); }
    });
  }
  document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
